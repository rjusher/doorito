{% extends "frontend/base.html" %}

{% block page_title %}Upload â€” Doorito{% endblock %}
{% block page_header %}Upload Files{% endblock %}
{% block sidebar_active %}upload{% endblock %}

{% block page_content %}
<div class="max-w-2xl">
  <form method="post"
        enctype="multipart/form-data"
        hx-post="{% url 'frontend:upload' %}"
        hx-target="#upload-results"
        hx-swap="innerHTML"
        x-data="uploadZone()"
        class="space-y-6">
    {% csrf_token %}

    {# Drop zone #}
    <div @dragover.prevent="dragOver = true"
         @dragleave.prevent="dragOver = false"
         @drop.prevent="handleDrop($event)"
         :class="dragOver ? 'border-primary-500 bg-primary-50' : 'border-neutral-300'"
         class="border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer"
         @click="$refs.fileInput.click()">
      <input type="file"
             name="files"
             multiple
             x-ref="fileInput"
             @change="handleFiles($event)"
             class="hidden">
      <svg class="w-12 h-12 mx-auto text-neutral-400 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
      </svg>
      <p class="text-neutral-600">
        <span class="font-medium text-primary-600">Click to browse</span> or drag and drop
      </p>
      <p class="text-sm text-neutral-400 mt-1">Up to 10 files, 50 MB each</p>
    </div>

    {# Selected files preview #}
    <div x-show="fileNames.length > 0" x-cloak>
      <h3 class="text-sm font-medium text-neutral-700 mb-2" x-text="`${fileNames.length} file(s) selected`"></h3>
      <ul class="space-y-1">
        <template x-for="name in fileNames" :key="name">
          <li class="text-sm text-neutral-600 flex items-center gap-2">
            <svg class="w-4 h-4 text-neutral-400 shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>
            <span x-text="name"></span>
          </li>
        </template>
      </ul>
    </div>

    {# Submit button #}
    <button type="submit"
            x-show="fileNames.length > 0"
            x-cloak
            class="bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
      Upload
    </button>
  </form>

  {# Results area (swapped by HTMX) #}
  <div id="upload-results" class="mt-6"></div>

  {% if messages %}
  <div class="mt-6 space-y-2">
    {% for message in messages %}
    <div class="rounded-lg p-4 text-sm
      {% if message.tags == 'success' %}bg-success-50 text-success-700 border border-success-200
      {% elif message.tags == 'warning' %}bg-warning-50 text-warning-700 border border-warning-200
      {% elif message.tags == 'error' %}bg-danger-50 text-danger-700 border border-danger-200
      {% else %}bg-info-50 text-info-700 border border-info-200{% endif %}">
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>

<script>
  function uploadZone() {
    return {
      dragOver: false,
      fileNames: [],
      handleDrop(event) {
        this.dragOver = false;
        this.$refs.fileInput.files = event.dataTransfer.files;
        this.updateFileNames();
      },
      handleFiles(event) {
        this.updateFileNames();
      },
      updateFileNames() {
        this.fileNames = Array.from(this.$refs.fileInput.files).map(f => f.name);
      }
    }
  }
</script>
{% endblock %}
